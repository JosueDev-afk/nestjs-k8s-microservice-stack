{{- $root := . -}}
{{- $components := list
  (dict "name" "api-gateway" "values" .Values.apiGateway)
  (dict "name" "user-service" "values" .Values.userService)
  (dict "name" "product-service" "values" .Values.productService)
  (dict "name" "notification-service" "values" .Values.notificationService)
  (dict "name" "postgres" "values" .Values.postgres)
  (dict "name" "mongodb" "values" .Values.mongodb)
  (dict "name" "redis" "values" .Values.redis)
}}
{{- range $components }}
{{- $secret := .values.secretEnv -}}
{{- if $secret }}
---
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: {{ include "nestjs-microservices.secretName" (dict "root" $root "name" .name) }}
  labels:
    {{- include "nestjs-microservices.componentLabels" (dict "root" $root "component" .name) | nindent 4 }}
data:
  {{- range $key, $value := $secret }}
  {{ $key }}: {{ $value | toString | b64enc | quote }}
  {{- end }}
{{- end }}
{{- end }}
